<!DOCTYPE html>
<html >
<head>
  <meta charset="utf-8" />
  <title>RNNVis</title>

  <link rel="stylesheet" type="text/css" href="{{url_for('static', filename = 'css/index.css')}}">
  <link rel="stylesheet" type="text/css" href="{{url_for('static', filename = 'css/html5reset.css')}}">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=PT+Serif&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Ramabhadra&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
  <script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.jquery.min.js"></script>
  <link href="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.min.css" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/85ffd7a6f1.js" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="{{url_for('static', filename = 'js/d3.layout.cloud.js')}}"></script>
  <style>
    @import url(https://fonts.googleapis.com/css?family=Josefin+Sans:300,400);
    * {
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
    }
    img {
      padding: 30px
    }
    section {
      position: relative;
      width: 100%;
      height: 100%;
    }
    /* section::after {
      position: absolute;
      bottom: 0;
      left: 0;
      content: '';
      width: 100%;
      height: 80%;
    } */
    /* section h1 {
      position: absolute;
      top: 50%;
      left: 50%;
      z-index: 2;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      color: #fff;
      font : normal 300 64px/1 'Josefin Sans', sans-serif;
      text-align: center;
      white-space: nowrap;
    } */

    #section01 { 
      background: rgb(242,180,118) center no-repeat;
      background-size: 1700px 800px;
    }
    #section02 { background: rgb(228, 172, 124)  center center / cover no-repeat;}
    #section03 { background: rgb(254, 255, 251)  center center / cover;}
    #section04 { background: rgb(247, 235, 210)  center center / cover no-repeat;}
    #section05 { background: rgb(248, 216, 190)  center center / cover no-repeat;}
    #section06 { background: rgb(226, 208, 208)  center center / cover no-repeat;}
    /* #section10 { background: url(https://picsum.photos/1200/800?image=516) center center / cover no-repeat;} */
    #firstpage{
      position: absolute;
      right: 0px;
      bottom: 0px;
    }

    #thanks {
      background-color: rgb(251, 108, 171);
    }
    #thanks::after {
      content: none;
    }
    #thanks div {
      position: absolute;
      top: 50%;
      left: 50%;
      z-index: 2;
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      text-align: center;
    }
    #thanks h2 {
      margin-bottom: 60px;
      color: white;
      font : normal 300 64px/1 'chalkduster', fantasy;
      text-align: center;
      white-space: nowrap;
    }
    #thanks p {
      color: #333;
      font : normal 400 20px/1 'chalkduster', fantasy;
    }
    #thanks p a {
      color: #333;
      text-decoration: none;
      transition: color .3s;
    }
    #thanks p a:hover {
      color: #888;
    }
    .demo a {
      position: absolute;
      bottom: 20px;
      left: 50%;
      z-index: 2;
      display: inline-block;
      -webkit-transform: translate(0, -50%);
      transform: translate(0, -50%);
      color: #fff;
      font : normal 400 20px/1 'Josefin Sans', sans-serif;
      letter-spacing: .1em;
      text-decoration: none;
      transition: opacity .3s;
    }
    .demo a:hover {
      opacity: .5;
    }

    #section01 a {
      padding-top: 60px;
    }
    #section01 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }


    #section02 a {
      padding-top: 60px;
    }
    #section02 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }

    #section03 a {
      padding-top: 60px;
    }
    #section03 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }


    #section04 a {
      padding-top: 60px;
    }
    #section04 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }

    #section05 a {
      padding-top: 60px;
    }
    #section05 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }


    #section06 a {
      padding-top: 60px;
    }
    #section06 a span {
      position: absolute;
      top: 0;
      left: 50%;
      width: 24px;
      height: 24px;
      margin-left: -12px;
      border-left: 1px solid rgb(15, 15, 15);
      border-bottom: 1px solid rgb(20, 20, 20);
      -webkit-transform: rotate(-45deg);
      transform: rotate(-45deg);
      box-sizing: border-box;
    }
  </style>
  
  <style>
    body {
      font-family: "Lato", sans-serif;
    }
    
    .sidenav {
      height: 100%;
      width: 160px;
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #C4BDAC;
      overflow-x: hidden;
      padding-top: 20px;
    }
    
    .sidenav a {
      padding: 6px 8px 6px 16px;
      text-decoration: none;
      font-size: 25px;
      color: white;
      display: block;
    }

    .sidenav a:hover {
      color: #575454;
    }
    
    .main {
      margin-left: 160px; /* Same as the width of the sidenav */
      font-size: 18px; /* Increased text to enable scrolling */
      padding: 0px 0px;
      background-color: #f4eee1;
      color: #555454;
    }
    
    body{
      background-color: #f4eee1;
    }
    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 18px;}
    }

    .button{
      background-color: #8E9AAF;
      border: none;
      color: white;
      padding: 10px 25px;
      text-align: center;
      font-size: 18px;
      margin: 4px 2px;
      opacity: 0.6;
      transition: 0.3s;
      display: inline-block;
      text-decoration: none;
      cursor: pointer;
    }
    .button:hover {opacity: 1}
    .button_send{
      background-color: #8E9AAF;
      border: none;
      color: white;
      padding: 10px 25px;
      text-align: center;
      font-size: 18px;
      margin: 4px 2px;
      opacity: 0.6;
      transition: 0.3s;
      display: inline-block;
      text-decoration: none;
      cursor: pointer;
    }
    .button_send:hover {opacity: 1}
    .user_table {
      margin-left: auto;
      margin-right: auto;
    }
    .model_table {
      margin-left: auto;
      margin-right: auto;
    }
    .user_choice_table {
      margin-left: auto;
      margin-right: auto;
    }
    
    .user_table tr {background: #CBC0D3;}
    .user_table tr:nth-of-type(2) {background: #EFD3D7;}
    .model_table tr {
      background: white;
    }
    .user_table td {
      padding: 15px;
    }
    .model_table td {
      padding: 15px;
    }
    .user_choice_table tr{
      background: #e6ddf0;
    }
    .user_choice_table td {
      padding: 15px;
    }
    .typewriter{
      font-family: chalkduster, fantasy;
/*      font-size: 00%;*/
      font-size: 30px;
      color: white;
      letter-spacing: .17em;
      margin: 0 auto;
      overflow: hidden;
      white-space: nowrap;
      border-right: .17em solid pink;
      animation: typing 3.5s steps(30, end), blinking-cursor .5s step-end infinite;
    }

    .search-result{
      font-family: chalkduster, fantasy;
      color: white;
      font-size: 22px;
      letter-spacing: .17em;
      margin: 0 15%;
    }

    @keyframes typing {
      from {
        width: 0
      }
      to {
        width: 100%
      }
    }

    @keyframes blinking-cursor {
      from,
      to {
        border-color: transparent
      }
      50% {
        border-color: pink;
      }
    }
    .sec2_text {
      font-family: chalkduster, fantasy;
      color: white;
    }

    .img{
      border:0;
    }

    .sentences {
      background: white;
    }
    table {opacity: 0.8}
  </style>
</head>
 
<body onload="javascript:hideTable()">
  <!-- <body> -->
  <section id="section01" class="demo">
    <center>
      <br></br>
      <h1 class = "typewriter"> 😊 Explaining Sentiment Analysis 😊 </h1>
      <h2 class = "typewriter"> Why are you feeling happy? </h2>
      <br></br>
      <div id="search">
        <form action="" method="post" class="flex-container">
            <input type="text" name="search" class = 'search-box' placeholder="Type in a happy moment in 2020" required>
            <button type=submit class = 'search-btn'><i class="fas fa-search"></i></button>
        </form>
      </div>
      {% if  search_query %}
        <h2 class = "search-result" style="color: gray;">Happiness source of '{{search_query}}' might be <span style="color: black;">{{search_label}}</span>.</h2>  
        
        {% endif %}
      </br>
    <h2 class = "search-result" ><span style="color: green;">Christ</span><span style="color: red;">mas</span> is coming! A good time to summarize your 2020 experinece.</h2>

    </center>
    <img id="firstpage" src="https://www.linkpicture.com/q/FirstPage_cut.jpg" height="260px" width=700px >
    <a href="#section02"><span></span></a >
    </section>

  <section id="section02" class="demo">
    <center>
      <br></br>
      <h1 class = "typewriter"> 😊 Source of Happiness 😊 </h1>
    </center>
    <center><img src="https://www.linkpicture.com/q/SecondPage.png" height="400px" width="600px"></center>
    <center>
      <p class = "sec2_text">Here we introduce 7 common sources of happiness:</p> 
      <b class = "sec2_text">bonding 🤝, affection 🥰, achievement 🎉, nature 🌲, leisure 😎, exercise 🏋️ and enjoy the moment 😮</b>
    </center>
    <a href="#section03"><span></span></a>

  </section>

  <section id="section03" class="demo">
    <div>
      <table class="user_table">
        <tr>
          <td width="900px">
            <h3> A happy moment: </h3>
            
            <button class="button" onclick="next_sent()">switch </button>
            <!-- <a class="button" href="{{url_for('show_index')}}">switch</a> -->
            <h4> {{sentence}} </h4>
            <p> Your current selected words is: <span id="selected_word"></span></p>
            
          </td>
          <td width="250px">
            <p> <b>Which source of happiness?</b> </p>
            {% for i in range(0,7) %}
                <input type="radio" id = "{{i}}" value="{{label_intdic[i]}}" name="{{label_intdic[i]}}">
                <label for="i">{{label_intdic[i]}}</label><br>
            {% endfor %}
            
          </td>
          <td>
            <b> Confirm your choice? </b>
            <button class="button_send" onClick="send()">Yes </button>
          </td>
        </tr>
        
        <!-- <tr>
          <td colspan="2">
            <b> Are you satisfied with your choices? </b>
            <button class="button_send" onClick="send()">Yes </button>
          </td>
        </tr> -->
      </table>


      <table class="model_table" id="model_table">
        <tr>
          <td width = "800px;" style="vertical-align: top;" id="td1">
            <h3 id="modeloutput"> Model Output: </h3>
            <div id = "test2"> </div>
            <br>
            <p id = "model_pred"> Above is the visualization of the model's output. Based on the sentence, the model has categorized its happy source as <strong>{{explanation}}</strong>.
              <br></br>
              The ground truth category of the happy source: <strong>{{true_label}}</strong>.
            </p>

          </td>
          <td width = "650px" id="td2">
            <div id = "lime_explanation"> </div>
            <div id = "lime_predict_prob"> </div>       
          </td>
        </tr>
      </table>

  
      <table class="user_choice_table" id="user_choice_table">
        <tr>
          <td width = 1470px;>
            <h3> Conclusion: </h3>
            <p> Your selected words are <span id="result_words"></span>. </p>
            <p> You think the source of happiness for this sentence is <span id="checked_label">. </span></p>
          </td>
          
        </tr>
        
      </table>
    </div>
    
    <script>
      function next_sent() {
        location.reload(true);
      }
      
      $.ajax({
          url: "static/model/lime.html",
          cache: false,
          dataType: "html",
          success: function(data) {
            $("#lime_predict_prob").html(data);
            // $("#lime_predict_prob").style.visibility = "hidden";
            $('#lime_predict_prob .text_div').detach().prependTo('#test2');
            $('#lime_predict_prob .text_div h3').html("");      
            $("#lime_predict_prob .predict_proba").before($("#lime_predict_prob .explanation"));
            $('#test2 .text_div').hide();
            $("#lime_predict_prob .predict_proba").hide();
            $("#lime_predict_prob .explanation").hide();
          }
      });
      
      var result_words = [];
      var words = $( "h4" ).first().text().split( /\s+/ );
      var text = words.join( "</span> <span>" );
      
      $( "h4" ).first().html( "<span>" + text + "</span>" );
      $( "span" ).on( "click", function() {
        if (this.style.backgroundColor == "yellow"){
          $( this ).css( "background-color", "" );
          var word = result_words.indexOf(this.innerText);
          result_words.splice(word,1);
        }
        else{
          $( this ).css( "background-color", "yellow" );
          result_words.push(this.innerText);
        }
    
        var selection = window.getSelection();
        if (!selection || selection.rangeCount < 1) return true;
        var range = selection.getRangeAt(0);
        var node = selection.anchorNode;
        var word_regexp = /^\w*$/;
    
        // Extend the range backward until it matches word beginning
        while ((range.startOffset > 0) && range.toString().match(word_regexp)) {
          range.setStart(node, (range.startOffset - 1));
        }
        // Restore the valid word match after overshooting
        if (!range.toString().match(word_regexp)) {
          range.setStart(node, range.startOffset + 1);
        }
    
        // Extend the range forward until it matches word ending
        while ((range.endOffset < node.length) && range.toString().match(word_regexp)) {
          range.setEnd(node, range.endOffset + 1);
        }
        // Restore the valid word match after overshooting
        if (!range.toString().match(word_regexp)) {
          range.setEnd(node, range.endOffset - 1);
        }
    
        var word = range.toString();
        // alert(word);
        document.getElementById("selected_word").innerHTML = word;
        
      });
    
      // hide table
      function hideTable(){
        document.getElementById('modeloutput').style.display = 'none';
        document.getElementById('model_pred').style.display = 'none';
        document.getElementById('user_choice_table').style.display = 'none';
        document.getElementById('s_model_table').style.display = 'none';
        document.getElementById('s_user_choice_table').style.display = 'none';
      }
    
      function send(){
        // show table
        document.getElementById('modeloutput').style.display = 'block';
        document.getElementById('model_pred').style.display = 'block';
        document.getElementById('user_choice_table').style.display = 'table';
        $('#test2 .text_div').show();
        $("#lime_predict_prob .predict_proba").show();
        $("#lime_predict_prob .explanation").show();
    
        var checked_label;
        var label_intdic = {0: 'achievement', 1:'affection',2:'bonding',3:'enjoy the moment',4:'exercise',5:'leisure',6:'nature'};
        for(i=0; i<7; i++){
          if (document.getElementById(i).checked == true){
            checked_label = i;
          }
        }
        
        
        document.getElementById("result_words").innerHTML = result_words;
        document.getElementById("checked_label").innerHTML = label_intdic[checked_label];
    
        var send_back = {
          'word_list': result_words,
          'checked_source': checked_label
        }
        // alert(send_back);
        $.ajax({
          url: '/',
          type: 'POST',
          contentType: 'application/json;charset=UTF-8',
          data: JSON.stringify(send_back),   // converts js value to JSON string
          })
          .done(function(result){     // on success get the return object from server
              console.log(result);     // do whatever with it. In this case see it in console
          });
      }
    </script>
    
    <a href="#section04"><span></span></a>
  </section>


  <section id="section04" class="demo">
    <div>
      <table class="user_table">
        <tr>
          <td width="900px">
            <h3> A random tweet: </h3>
            
            <button class="button" onclick="next_sent()">switch </button>
            <h5> {{s_sentence}} </h4>
            <p> Your current selected words is: <span id="selected_word2"></span></p>
            
          </td>
          <td width="250px">
            <p> <b>Positive or negative sentiment?</b> </p>          
            <input type="radio" id = "s_0" value="unhappy" name="unhappy">
            <label for="s_0">unhappy</label><br>
            <input type="radio" id = "s_1" value="happy" name="happy">
            <label for="s_1">happy</label><br>
            
          </td>
          <td>
            <b> Confirm your choice? </b>
            <button class="button_send" onClick="s_send()">Yes </button>
          </td>
        </tr>
      </table>


      <table class="model_table" id="s_model_table">
        <tr>
          <td width = "785px;" style="vertical-align: top;" id="td1">
            <h3 id="s_modeloutput"> Model Output: </h3>
            <div id = "s_test2"> </div>
            <br>
            <p id = "s_model_pred"> Above is the visualization of the model's output. Based on the sentence, the model has categorized sentiment of the tweet as <strong>{{s_explanation}}</strong>.
              <br></br>
              The ground truth category of the sentiment: <strong>{{s_true_label}}</strong>.   
            </p>

          </td>
          <td width = "650px" id="td2">
            <div id = "s_lime_explanation"> </div>
            <div id = "s_lime_predict_prob"> </div>       
          </td>
        </tr>
      </table>

  
      <table class="user_choice_table" id="s_user_choice_table">
        <tr>
          <td width = 1470px>
            <h3> Conclusion: </h3>
            <p> Your selected words are <span id="s_selected_word"></span>. </p>
            <p> You think the source of happiness for this sentence is <span id="s_checked_label">. </span></p>
          </td>
          
        </tr>
        
      </table>
    </div>
    
    <script> 
      $.ajax({
          url: "static/sentiment_model/lime.html",
          cache: false,
          dataType: "html",
          success: function(data) {
            $("#s_lime_predict_prob").html(data);
            $('#s_lime_predict_prob .text_div').detach().prependTo('#s_test2');
            $('.text_div h3').html("");      
            $("#s_lime_predict_prob .predict_proba").before($("#s_lime_predict_prob .explanation"));
            $('#s_test2 .text_div').hide();
            $("#s_lime_predict_prob .predict_proba").hide();
            $("#s_lime_predict_prob .explanation").hide();
          }
      });
      
      function s_send(){
        // show table
        document.getElementById('s_model_table').style.display = 'table';
        document.getElementById('s_user_choice_table').style.display = 'table';
        $('#s_test2 .text_div').show();
        $("#s_lime_predict_prob .predict_proba").show();
        $("#s_lime_predict_prob .explanation").show();
    
        var s_checked_label;
        var s_label_intdic = {0: 'unhappy', 1:'happy'};
        for(i=0; i<2; i++){
          if (document.getElementById("s_"+i).checked == true){
            s_checked_label = i;
          }
        }
      
        document.getElementById("s_selected_word").innerHTML = result_words2;
        document.getElementById("s_checked_label").innerHTML = s_label_intdic[s_checked_label];
  
      }

      var result_words2 = [];
      var words2 = $( "h5" ).first().text().split( /\s+/ );
      var text2 = words2.join( "</span2> <span2>" );
      $( "h5" ).first().html( "<span2>" + text2 + "</span2>" );
      $( "span2" ).on( "click", function() {
        if (this.style.backgroundColor == "yellow"){
          $( this ).css( "background-color", "" );
          var word2 = result_words2.indexOf(this.innerText);
          result_words2.splice(word2,1);
        }
        else{
          $( this ).css( "background-color", "yellow" );
          result_words2.push(this.innerText);
        }
    
        var selection2 = window.getSelection();
        if (!selection2 || selection2.rangeCount < 1) return true;
        var range2 = selection2.getRangeAt(0);
        var node2 = selection2.anchorNode;
        var word_regexp2 = /^\w*$/;
    
        // Extend the range backward until it matches word beginning
        while ((range2.startOffset > 0) && range2.toString().match(word_regexp2)) {
          range2.setStart(node2, (range2.startOffset - 1));
        }
        // Restore the valid word match after overshooting
        if (!range2.toString().match(word_regexp2)) {
          range2.setStart(node2, range2.startOffset + 1);
        }
    
        // Extend the range forward until it matches word ending
        while ((range2.endOffset < node2.length) && range2.toString().match(word_regexp2)) {
          range2.setEnd(node2, range.endOffset + 1);
        }
        // Restore the valid word match after overshooting
        if (!range2.toString().match(word_regexp2)) {
          range2.setEnd(node2, range2.endOffset - 1);
        }
    
        var word2 = range2.toString();
        document.getElementById("s_selected_word").innerHTML = result_words2;        
      });
    </script>
    

    <a href="#section05"><span></span></a>
  </section>


  <section id="section05" class="demo">

    <a href="#section06"><span></span></a>
  </section>


  <section id="section06" class="demo">
    <h1>Result Bar Chart</h1>
    <a href="#thanks"><span></span></a>
  </section>


  <section id="thanks">
    <div>
      <h2 class = "typewriter">😄Thank You!😉</h2>
      <img src="https://media.giphy.com/media/l0IyiY9zRnf6nH5Cw/giphy.gif" style="width: 300px;  height: auto">
    </div>
  </section>
</body>

</html>